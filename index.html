<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMS Bot Pro | USDT TRC20</title>
    <style>
        :root {
            --primary: #6c5ce7;
            --primary-dark: #4834d4;
            --secondary: #00b894;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #0984e3;
            --dark: #2d3436;
            --light: #f5f6fa;
            --gray: #dfe6e9;
            --success: #00b894;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        
        body {
            background: #0f0c29;
            background: linear-gradient(135deg, #24243e, #302b63, #0f0c29);
            min-height: 100vh;
            padding: 10px;
            color: var(--dark);
        }
        
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            overflow: hidden;
            min-height: 95vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px 20px 25px;
            text-align: center;
            position: relative;
        }
        
        .header::after {
            content: ''; position: absolute; bottom: -1px; left: 0; right: 0;
            height: 25px; background: white; border-radius: 25px 25px 0 0;
        }
        
        .user-info {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            margin-top: 15px;
        }

        /* Balance Card */
        .balance-card {
            background: white;
            margin: 10px 20px 20px;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            border: 1px solid var(--gray);
        }
        
        .balance-amount { font-size: 42px; font-weight: 800; color: var(--primary); }            position: fixed; top:0; left:0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; z-index: 1000;
            align-items: center; justify-content: center; padding: 20px;
        }
        .modal {
            background: white; border-radius: 20px; width: 100%; max-width: 400px;
            max-height: 90vh; overflow-y: auto; padding: 25px;
        }
        .qr-wrap { text-align: center; margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 15px; }
        canvas { max-width: 100% !important; height: auto !important; }

        /* History */
        .history-item {
            background: white; padding: 15px; border-radius: 12px;
            margin-bottom: 10px; border-left: 5px solid var(--primary);
            font-size: 13px;
        }
        .history-item.payment { border-left-color: var(--success); }
        
        .status-pill {
            padding: 3px 8px; border-radius: 5px; font-size: 10px;
            text-transform: uppercase; font-weight: bold; float: right;
        }
        .status-pending { background: #ffeaa7; color: #d35400; }
        .status-success { background: #55efc4; color: #00b894; }

        /* Utils */
        .copy-area {
            background: #f1f2f6; padding: 10px; border-radius: 8px;
            font-family: monospace; font-size: 12px; position: relative;
            word-break: break-all; margin: 10px 0; border: 1px dashed #ccc;
        }
        .loading-spinner {
            width: 30px; height: 30px; border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite; margin: 10px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h2 id="app-title"><i class="fas fa-comment-sms"></i> SMS BOT CLOUD</h2>
        <div class="user-info">
            <span><i class="fas fa-id-badge"></i> ID: <span id="my-id">Загрузка...</span></span>
            <span><i class="fas fa-shield-halved"></i> Статус: User</span>
        </div>
    </div>

    <div class="balance-card">
        <div class="balance-label">Доступно для отправки</div>
        <div class="balance-amount" id="user-balance">0</div>
        <div style="color: var(--secondary); font-size: 12px; font-weight: 600;">SMS СООБЩЕНИЙ</div>
    </div>

    <div class="nav-tabs">
        <button class="tab active" onclick="showSection('shop')"><i class="fas fa-store"></i>Пакеты</button>
        <button class="tab" onclick="showSection('send')"><i class="fas fa-paper-plane"></i>Отправить</button>
        <button class="tab" onclick="showSection('history')"><i class="fas fa-list-ul"></i>История</button>
        <button class="tab" onclick="showSection('profile')"><i class="fas fa-user-gear"></i>Профиль</button>
        <button class="tab admin-only" onclick="showSection('admin')" style="display:none;"><i class="fas fa-crown"></i>Админ</button>
    </div>

    <div class="content">
        <!-- Магазин -->
        <div id="shop" class="section active">
            <h4 style="margin-bottom:15px;">Выберите пакет пополнения:</h4>
            <div id="packages-list"></div>
        </div>

        <!-- Отправка -->
        <div id="send" class="section">
            <div class="form-group">
                <label>Номер телефона</label>
                <input type="tel" id="sms-phone" placeholder="+79000000000">
            </div>
            <div class="form-group">
                <label>Текст сообщения (латиница/кириллица)</label>
                <textarea id="sms-text" rows="4" placeholder="Введите ваше сообщение..."></textarea>
                <div style="font-size: 11px; text-align: right; color: #888;" id="char-count">0 / 160</div>
            </div>
            <div class="form-group">
                <label>Приоритет</label>
                <select id="sms-priority">
                    <option value="1">Обычный (бесплатно)</option>
                    <option value="2">Высокий (+1 SMS)</option>
                </select>
            </div>
            <div id="cost-info" style="background:#fff; padding:10px; border-radius:10px; margin-bottom:15px; font-size:14px;">
                Итого к списанию: <b id="total-sms-cost">1</b> SMS
            </div>
            <button class="btn-main" onclick="processSendSMS()">ОТПРАВИТЬ СЕЙЧАС</button>
        </div>

        <!-- История -->
        <div id="history" class="section">
            <h4 style="margin-bottom:15px;">Последние операции:</h4>
            <div id="history-container"></div>
        </div>

        <!-- Профиль -->
        <div id="profile" class="section">
            <div style="background:white; padding:20px; border-radius:15px; text-align:center;">
                <i class="fas fa-circle-user" style="font-size:60px; color: var(--primary); margin-bottom:10px;"></i>').value) - 1;
            document.getElementById('total-sms-cost').innerText = baseCost + extra;
        };
    };

    function save() {
        localStorage.setItem('sms_bot_user', JSON.stringify(user));
    }

    function updateUI() {
        document.getElementById('user-balance').innerText = user.balance;
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // --- SHOP LOGIC ---
    function renderPackages() {
        const container = document.getElementById('packages-list');
        container.innerHTML = '';
        CONFIG.PACKAGES.forEach(pkg => {
            const usdt = (pkg.price / CONFIG.USDT_RATE).toFixed(2);
            container.innerHTML += `
                <div class="shop-item" onclick="openPayment(${pkg.id})">
                    <div class="item-row">
                        <div>
                            <div class="sms-qty">${pkg.qty} SMS</div>
                            <div style="font-size:12px; color:#777;">Быстрая доставка</div>
                        </div>
                        <div class="price-badge">${usdt} USDT</div>
                    </div>
                </div>
            `;
        });
    }

    function openPayment(pkgId) {
        const pkg = CONFIG.PACKAGES.find(p => p.id === pkgId);
        const usdt = (pkg.price / CONFIG.USDT_RATE).toFixed(2);
        
        currentOrder = { ...pkg, usdt: usdt };
        
        document.getElementById('pay-amount').innerText = usdt + " USDT";
        document.getElementById('pay-modal').style.display = 'flex';
        
        // Генерация QR
        QRCode.toCanvas(document.getElementById('qrcode'), `tron:${CONFIG.WALLET}?amount=${usdt}`, function (error) {
            if (error) console.error(error);
        });
    }

    function closeModal() {
        document.getElementById('pay-modal').style.display = 'none';
        document.getElementById('payment-status-area').innerHTML = `
            <button class="btn-main" id="check-pay-btn" onclick="verifyPayment()">Я ОПЛАТИЛ</button>
        `;
    }

    function copyWallet() {
        navigator.clipboard.writeText(CONFIG.WALLET);
        alert("Адрес скопирован!");
    }

    // --- PAYMENT VERIFICATION (SIMULATION) ---
    function verifyPayment() {
        const area = document.getElementById('payment-status-area');
        area.innerHTML = `
            <div style="text-align:center;">
                <div class="loading-spinner"></div>
                <p style="font-size:12px; color:var(--primary);">Поиск транзакции в сети TRON...</p>
            </div>
        `;

        // Имитация проверки блокчейна (3 секунды)
        setTimeout(() => {
            // В реальности тут должен быть запрос к API (напр. TronGrid)
            // if(checkChain(CONFIG.WALLET, currentOrder.usdt)) ...
            
            completePayment();
        }, 3500);
    }

    function completePayment() {
        user.balance += currentOrder.qty;
        user.history.unshift({
            type: 'Пополнение',
            desc: `Пакет ${currentOrder.qty} SMS`,
            date: new Date().toLocaleString(),
            amount: `+${currentOrder.qty}`,
            status: 'success'
        });
        
        save();
        updateUI();
        renderHistory();
        
        const area = document.getElementById('payment-status-area');
        area.innerHTML = `
            <div style="text-align:center; color: var(--success);">
                <i class="fas fa-check-circle" style="font-size:40px;"></i>
                <p><b>Оплата получена!</b></p>
            </div>
        `;
        
        setTimeout(() => {
            closeModal();
            alert(`Успешно! Начислено ${currentOrder.qty} SMS.`);
        }, 2000);
    }

    // --- SMS LOGIC ---
    function processSendSMS() {
        const phone = document.getElementById('sms-phone').value;
        const text = document.getElementById('sms-text').value;
        const cost = parseInt(document.getElementById('total-sms-cost').innerText);

        if (!phone || !text) return alert("Заполните все поля!");
        if (user.balance < cost) return alert("Недостаточно баланса!");

        if (confirm(`Отправить SMS на номер ${phone}? Списание: ${cost} SMS`)) {
            user.balance -= cost;
            user.history.unshift({
                type: 'Отправка',
                desc: `На номер: ${phone}`,
                date: new Date().toLocaleString(),
                amount: `-${cost}`,
                status: 'success'
            });
            
            save();
            updateUI();
            renderHistory();
            
            alert("Сообщение поставлено в очередь на отправку!");
            document.getElementById('sms-phone').value = '';
            document.getElementById('sms-text').value = '';
        }
    }

    function renderHistory() {
        const container = document.getElementById('history-container');
        container.innerHTML = '';
        
        if (user.history.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#999; margin-top:20px;">Истории пока нет</p>';
            return;
        }

        user.history.forEach(item => {
            container.innerHTML += `
                <div class="history-item ${item.amount.includes('+') ? 'payment' : ''}">
                    <span class="status-pill status-${item.status}">${item.status === 'success' ? 'Выполнено' : 'Ожидание'}</span>
                    <b>${item.type}</b><br>
                    <span style="color:#666;">${item.desc}</span><br>
                    <small style="color:#aaa;">${item.date}</small>
                    <div style="text-align:right; font-weight:bold; color: ${item.amount.includes('+') ? 'var(--success)' : 'var(--danger)'};">
                        ${item.amount}
                    </div>
                </div>
            `;
        });
    }

    // --- ADMIN ---
    function adminAddBalance() {
        const id = document.getElementById('adm-user-id').value;
        const amt = parseInt(document.getElementById('adm-amount').value);
        
        if (id == user.id) {
            user.balance += amt;
            save();
            updateUI();
            alert("Баланс начислен вам!");
        } else {
            alert("Пользователь не найден в этой сессии (локально).");
        }
    }
</script>

</body>
        </html>>
                <i class="fas fa-check-circle" style="font-size:40px;"></i>
                <p><b>Оплата получена!</b></p>
            </div>
        `;
        
        setTimeout(() => {
            closeModal();
            alert(`Успешно! Начислено ${currentOrder.qty} SMS.`);
        }, 2000);
    }

    // --- SMS LOGIC ---
    function processSendSMS() {
        const phone = document.getElementById('sms-phone').value;
        const text = document.getElementById('sms-text').value;
        const cost = parseInt(document.getElementById('total-sms-cost').innerText);

        if (!phone || !text) return alert("Заполните все поля!");
        if (user.balance < cost) return alert("Недостаточно баланса!");

        if (confirm(`Отправить SMS на номер ${phone}? Списание: ${cost} SMS`)) {
            user.balance -= cost;
            user.history.unshift({
                type: 'Отправка',
                desc: `На номер: ${phone}`,
                date: new Date().toLocaleString(),
                amount: `-${cost}`,
                status: 'success'
            });
            
            save();
            updateUI();
            renderHistory();
            
            alert("Сообщение поставлено в очередь на отправку!");
            document.getElementById('sms-phone').value = '';
            document.getElementById('sms-text').value = '';
        }
    }

    function renderHistory() {
        const container = document.getElementById('history-container');
        container.innerHTML = '';
        
        if (user.history.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#999; margin-top:20px;">Истории пока нет</p>';
            return;
        }

        user.history.forEach(item => {
            container.innerHTML += `
                <div class="history-item ${item.amount.includes('+') ? 'payment' : ''}">
                    <span class="status-pill status-${item.status}">${item.status === 'success' ? 'Выполнено' : 'Ожидание'}</span>
                    <b>${item.type}</b><br>
                    <span style="color:#666;">${item.desc}</span><br>
                    <small style="color:#aaa;">${item.date}</small>
                    <div style="text-align:right; font-weight:bold; color: ${item.amount.includes('+') ? 'var(--success)' : 'var(--danger)'};">
                        ${item.amount}
                    </div>
                </div>
            `;
        });
    }

    // --- ADMIN ---
    function adminAddBalance() {
        const id = document.getElementById('adm-user-id').value;
        const amt = parseInt(document.getElementById('adm-amount').value);
        
        if (id == user.id) {
            user.balance += amt;
            save();
            updateUI();
            alert("Баланс начислен вам!");
        } else {
            alert("Пользователь не найден в этой сессии (локально).");
        }
    }
</script>

</body>
        </html>
